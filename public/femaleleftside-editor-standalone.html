<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Female Left Side - Interactive Coordinate Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #7c3aed 0%, #be185d 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 2000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }

        .header {
            background: linear-gradient(135deg, #7c3aed, #be185d);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .editing-banner {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .editing-banner p {
            margin: 0;
            font-size: 16px;
            font-weight: bold;
        }

        .main-content {
            display: flex;
            min-height: calc(100vh - 200px);
            height: auto;
        }

        .image-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f8fafc;
            border-right: 2px solid #e2e8f0;
        }

        .image-controls {
            padding: 20px;
            background: #f1f5f9;
            border-bottom: 1px solid #e2e8f0;
        }

        .file-input-container {
            margin-bottom: 20px;
        }

        .file-input-label {
            display: inline-block;
            background: #7c3aed;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
        }

        .file-input-label:hover {
            background: #6d28d9;
        }

        .file-input {
            display: none;
        }

        .image-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            color: #64748b;
        }

        .image-container {
            flex: 1;
            position: relative;
            overflow: auto;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            background: white;
            padding: 20px;
        }

        .medical-image {
            width: 512px;
            height: 768px;
            display: block;
            user-select: none;
            position: relative;
        }

        .coordinate-marker {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 3px solid white;
            cursor: grab;
            user-select: none;
            transition: all 0.2s;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .coordinate-marker:hover {
            transform: scale(1.2);
            z-index: 200;
            cursor: grab;
        }

        .coordinate-marker:active {
            cursor: grabbing;
        }

        .coordinate-marker.dragging {
            transform: scale(1.3);
            z-index: 300;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            cursor: grabbing;
        }

        /* Category colors for female left anatomy */
        .coordinate-marker.basic { background-color: #7c3aed; }
        .coordinate-marker.organs { background-color: #0891b2; }
        .coordinate-marker.reproductive { background-color: #be185d; }
        .coordinate-marker.skeletal { background-color: #059669; }
        .coordinate-marker.muscular { background-color: #dc2626; }

        .marker-label {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 1000;
            margin-bottom: 8px;
        }

        .coordinate-marker:hover .marker-label {
            opacity: 1;
        }

        .controls-panel {
            width: 400px;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .panel-section {
            border-bottom: 1px solid #e2e8f0;
        }

        .section-header {
            background: #f8fafc;
            padding: 15px 20px;
            font-weight: 700;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
        }

        .section-content {
            padding: 20px;
        }

        .category-toggles {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .category-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .category-toggle:hover {
            border-color: #7c3aed;
        }

        .category-toggle.active {
            background: #f3f4f6;
            border-color: #7c3aed;
        }

        .category-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .coordinates-display {
            max-height: 400px;
            overflow-y: auto;
        }

        .coordinate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
            font-size: 13px;
        }

        .coordinate-item:last-child {
            border-bottom: none;
        }

        .coordinate-name {
            font-weight: 600;
            color: #374151;
            text-transform: capitalize;
        }

        .coordinate-values {
            color: #6b7280;
            font-family: 'Courier New', monospace;
        }

        .export-section {
            padding: 20px;
        }

        .export-button {
            width: 100%;
            background: #7c3aed;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 15px;
        }

        .export-button:hover {
            background: #6d28d9;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: #faf5ff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9d5ff;
        }

        .stat-number {
            display: block;
            font-size: 24px;
            font-weight: 800;
            color: #7c3aed;
        }

        .stat-label {
            font-size: 12px;
            color: #6d28d9;
            font-weight: 600;
        }

        .instructions {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .instructions h4 {
            color: #92400e;
            margin-bottom: 8px;
        }

        .instructions ul {
            color: #92400e;
            font-size: 14px;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 4px;
        }

        .instructions strong {
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üë©‚Äç‚öïÔ∏è Female Left Side - Interactive Coordinate Editor</h1>
            <p>Upload your image, <strong>drag the colored dots</strong> to adjust positions, and export updated JSON</p>
            <div class="editing-banner">
                <p>üéØ EDITING MODE: Click and drag any colored marker to adjust its position!</p>
            </div>
        </div>
        
        <div class="main-content">
            <div class="image-panel">
                <div class="image-controls">
                    <div class="file-input-container">
                        <label for="imageFile" class="file-input-label">
                            üìÅ Upload Female Left Side Image
                        </label>
                        <input type="file" id="imageFile" class="file-input" accept="image/*">
                    </div>
                    <div class="image-info" id="imageInfo">
                        No image selected. Upload an image to begin editing coordinates.
                    </div>
                </div>
                
                <div class="image-container" id="imageContainer">
                    <div style="text-align: center; color: #64748b; padding: 40px;">
                        <p style="font-size: 18px; margin-bottom: 10px;">üì∏ Upload Image</p>
                        <p>Select your female left side medical image to start editing coordinates</p>
                    </div>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="panel-section">
                    <div class="section-header">üìä Statistics</div>
                    <div class="section-content">
                        <div class="stats">
                            <div class="stat-box">
                                <span class="stat-number" id="totalPoints">35</span>
                                <span class="stat-label">Total Points</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-number" id="basicPoints">23</span>
                                <span class="stat-label">Basic Anatomy</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-number" id="specializedPoints">12</span>
                                <span class="stat-label">Specialized</span>
                            </div>
                        </div>
                        
                        <div class="instructions">
                            <h4>üí° Interactive Editing Instructions:</h4>
                            <ul>
                                <li><strong>üìÅ Step 1:</strong> Upload your female left side medical image</li>
                                <li><strong>üéØ Step 2:</strong> Click and drag any colored dot to adjust position</li>
                                <li><strong>üëÄ Step 3:</strong> Hover over dots to see coordinate labels</li>
                                <li><strong>üé® Step 4:</strong> Use category buttons to focus on specific systems</li>
                                <li><strong>üíæ Step 5:</strong> Export updated JSON when positioning is perfect</li>
                                <li><strong>üîÑ Tip:</strong> Coordinates update automatically as you drag!</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="section-header">üéØ Category Toggles</div>
                    <div class="section-content">
                        <div class="category-toggles">
                            <div class="category-toggle active" data-category="basic">
                                <div class="category-color" style="background-color: #7c3aed;"></div>
                                <span>Basic Anatomy</span>
                            </div>
                            <div class="category-toggle active" data-category="organs">
                                <div class="category-color" style="background-color: #0891b2;"></div>
                                <span>Left Organs</span>
                            </div>
                            <div class="category-toggle active" data-category="reproductive">
                                <div class="category-color" style="background-color: #be185d;"></div>
                                <span>Reproductive</span>
                            </div>

                            <div class="category-toggle active" data-category="muscular">
                                <div class="category-color" style="background-color: #dc2626;"></div>
                                <span>Muscular</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="section-header">üìã Current Coordinates</div>
                    <div class="section-content">
                        <div class="coordinates-display" id="coordinatesDisplay">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="export-section">
                    <button class="export-button" onclick="exportJSON()">
                        üíæ Export Updated JSON
                    </button>
                    <button class="export-button" onclick="resetCoordinates()" style="background: #059669; margin-top: 10px;">
                        üîÑ Reset to Original
                    </button>
                    <div id="exportStatus" style="margin-top: 15px; font-size: 14px; text-align: center;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Female left side coordinates with categories
        let coordinates = {
            // Basic anatomy
            "head": { "x": 258, "y": 49, "width": 50, "height": 50, "category": "basic" },
            "face": { "x": 285, "y": 101, "width": 50, "height": 50, "category": "basic" },
            "nose": { "x": 307, "y": 103, "width": 50, "height": 50, "category": "basic" },
            "left_eye": { "x": 291, "y": 87, "width": 50, "height": 50, "category": "basic" },
            "left_ear": { "x": 248, "y": 103, "width": 50, "height": 50, "category": "basic" },
            "mouth": { "x": 297, "y": 123, "width": 50, "height": 50, "category": "basic" },
            "neck": { "x": 250, "y": 153, "width": 50, "height": 50, "category": "basic" },
            "chest": { "x": 287, "y": 216, "width": 50, "height": 50, "category": "basic" },
            "back": { "x": 201, "y": 232, "width": 50, "height": 50, "category": "basic" },
            "abdomen": { "x": 297, "y": 304, "width": 50, "height": 50, "category": "basic" },
            "spine": { "x": 199, "y": 265, "width": 50, "height": 50, "category": "basic" },
            "left_shoulder": { "x": 238, "y": 207, "width": 50, "height": 50, "category": "basic" },
            "left_elbow": { "x": 233, "y": 306, "width": 50, "height": 50, "category": "basic" },
            "left_arm": { "x": 238, "y": 255, "width": 50, "height": 50, "category": "basic" },
            "left_forearm": { "x": 258, "y": 352, "width": 50, "height": 50, "category": "basic" },
            "left_wrist": { "x": 285, "y": 392, "width": 50, "height": 50, "category": "basic" },
            "left_hand": { "x": 294, "y": 451, "width": 50, "height": 50, "category": "basic" },
            "left_hip": { "x": 253, "y": 459, "width": 50, "height": 50, "category": "basic" },
            "left_thigh": { "x": 264, "y": 481, "width": 50, "height": 50, "category": "basic" },
            "left_knee": { "x": 272, "y": 573, "width": 50, "height": 50, "category": "basic" },
            "left_calf": { "x": 198, "y": 620, "width": 50, "height": 50, "category": "basic" },
            "left_ankle": { "x": 240, "y": 714, "width": 50, "height": 50, "category": "basic" },
            "left_foot": { "x": 291, "y": 734, "width": 50, "height": 50, "category": "basic" },

            // Visible organs from left lateral profile
            "left_lung_profile": { "x": 220, "y": 220, "width": 120, "height": 140, "category": "organs" },
            "heart_shadow": { "x": 235, "y": 280, "width": 80, "height": 80, "category": "organs" },
            "diaphragm_dome_left": { "x": 230, "y": 330, "width": 100, "height": 30, "category": "organs" },
            "spleen_edge": { "x": 210, "y": 290, "width": 60, "height": 40, "category": "organs" },

            // Female anatomy visible from lateral profile
            "left_breast": { "x": 205, "y": 240, "width": 70, "height": 70, "category": "reproductive" },
            "left_nipple": { "x": 210, "y": 255, "width": 20, "height": 20, "category": "reproductive" },

            // Muscular system
            "pectoralis_major_left": { "x": 210, "y": 220, "width": 90, "height": 70, "category": "muscular" },
            "rectus_abdominis_left": { "x": 220, "y": 320, "width": 70, "height": 100, "category": "muscular" },
            "gluteus_maximus_left": { "x": 230, "y": 440, "width": 100, "height": 100, "category": "muscular" },
            "hamstring_left_profile": { "x": 240, "y": 530, "width": 70, "height": 120, "category": "muscular" },
            "gastrocnemius_left": { "x": 250, "y": 600, "width": 60, "height": 100, "category": "muscular" },
            "achilles_tendon_left": { "x": 248, "y": 690, "width": 30, "height": 60, "category": "muscular" }
        };

        let imageElement = null;
        let isDragging = false;
        let dragElement = null;
        let dragOffset = { x: 0, y: 0 };
        let visibleCategories = new Set(['basic', 'organs', 'reproductive', 'muscular']);

        // Store original coordinates for reset functionality
        const originalCoordinates = JSON.parse(JSON.stringify(coordinates));

        // Image upload handling
        document.getElementById('imageFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                loadImage(e.target.result, file.name);
            };
            reader.readAsDataURL(file);
        });

        function loadImage(src, filename) {
            const container = document.getElementById('imageContainer');
            container.innerHTML = '';
            
            imageElement = document.createElement('img');
            imageElement.src = src;
            imageElement.className = 'medical-image';
            
            imageElement.onload = function() {
                container.appendChild(imageElement);
                
                // Update image info
                document.getElementById('imageInfo').innerHTML = `
                    <strong>üì∏ Image:</strong> ${filename}<br>
                    <strong>üìê Dimensions:</strong> ${imageElement.naturalWidth} √ó ${imageElement.naturalHeight}px<br>
                    <strong>üìä Display Size:</strong> ${imageElement.offsetWidth} √ó ${imageElement.offsetHeight}px
                `;
                
                createMarkers();
            };
        }

        function createMarkers() {
            if (!imageElement) return;

            // Remove existing markers
            const existingMarkers = document.querySelectorAll('.coordinate-marker');
            existingMarkers.forEach(marker => marker.remove());

            // Create new markers
            Object.entries(coordinates).forEach(([name, coord]) => {
                if (!visibleCategories.has(coord.category)) return;

                const marker = document.createElement('div');
                marker.className = `coordinate-marker ${coord.category}`;
                marker.dataset.name = name;
                
                // Position marker
                updateMarkerPosition(marker, coord);
                
                // Add label
                const label = document.createElement('div');
                label.className = 'marker-label';
                label.textContent = `${name.replace(/_/g, ' ')} (${coord.x}, ${coord.y})`;
                marker.appendChild(label);
                
                // Add drag functionality
                addDragFunctionality(marker);
                
                imageElement.parentElement.appendChild(marker);
            });

            updateCoordinatesDisplay();
            updateStats();
        }

        function updateMarkerPosition(marker, coord) {
            if (!imageElement) return;
            
            const imageRect = imageElement.getBoundingClientRect();
            const containerRect = imageElement.parentElement.getBoundingClientRect();
            
            const scaleX = imageElement.offsetWidth / imageElement.naturalWidth;
            const scaleY = imageElement.offsetHeight / imageElement.naturalHeight;
            
            const x = (imageRect.left - containerRect.left) + (coord.x * scaleX);
            const y = (imageRect.top - containerRect.top) + (coord.y * scaleY);
            
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
        }

        function addDragFunctionality(marker) {
            marker.addEventListener('mousedown', startDrag);
        }

        function startDrag(e) {
            e.preventDefault();
            isDragging = true;
            dragElement = e.target.closest('.coordinate-marker');
            dragElement.classList.add('dragging');
            
            const rect = dragElement.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left - rect.width / 2;
            dragOffset.y = e.clientY - rect.top - rect.height / 2;
            
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', endDrag);
        }

        function handleDrag(e) {
            if (!isDragging || !dragElement || !imageElement) return;
            
            const containerRect = imageElement.parentElement.getBoundingClientRect();
            const imageRect = imageElement.getBoundingClientRect();
            
            let x = e.clientX - containerRect.left - dragOffset.x;
            let y = e.clientY - containerRect.top - dragOffset.y;
            
            // Constrain to image bounds
            const minX = imageRect.left - containerRect.left;
            const maxX = imageRect.right - containerRect.left;
            const minY = imageRect.top - containerRect.top;
            const maxY = imageRect.bottom - containerRect.top;
            
            x = Math.max(minX, Math.min(maxX, x));
            y = Math.max(minY, Math.min(maxY, y));
            
            dragElement.style.left = x + 'px';
            dragElement.style.top = y + 'px';
        }

        function endDrag(e) {
            if (!isDragging || !dragElement) return;
            
            // Update coordinate data
            const name = dragElement.dataset.name;
            const containerRect = imageElement.parentElement.getBoundingClientRect();
            const imageRect = imageElement.getBoundingClientRect();
            
            const markerRect = dragElement.getBoundingClientRect();
            const markerCenterX = markerRect.left + markerRect.width / 2;
            const markerCenterY = markerRect.top + markerRect.height / 2;
            
            const relativeX = markerCenterX - imageRect.left;
            const relativeY = markerCenterY - imageRect.top;
            
            const scaleX = imageElement.naturalWidth / imageElement.offsetWidth;
            const scaleY = imageElement.naturalHeight / imageElement.offsetHeight;
            
            const newX = Math.round(relativeX * scaleX);
            const newY = Math.round(relativeY * scaleY);
            
            coordinates[name].x = newX;
            coordinates[name].y = newY;
            
            // Update label
            const label = dragElement.querySelector('.marker-label');
            if (label) {
                label.textContent = `${name.replace(/_/g, ' ')} (${newX}, ${newY})`;
            }
            
            dragElement.classList.remove('dragging');
            isDragging = false;
            dragElement = null;
            
            document.removeEventListener('mousemove', handleDrag);
            document.removeEventListener('mouseup', endDrag);
            
            updateCoordinatesDisplay();
            
            // Show brief update indicator
            const statusDiv = document.getElementById('exportStatus');
            if (statusDiv && !statusDiv.innerHTML.includes('exported') && !statusDiv.innerHTML.includes('reset')) {
                statusDiv.innerHTML = '<span style="color: #059669;">üìç Coordinates updated</span>';
                setTimeout(() => {
                    if (statusDiv.innerHTML.includes('updated')) {
                        statusDiv.innerHTML = '';
                    }
                }, 2000);
            }
        }

        // Category toggle functionality
        document.querySelectorAll('.category-toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const category = this.dataset.category;
                
                if (visibleCategories.has(category)) {
                    visibleCategories.delete(category);
                    this.classList.remove('active');
                } else {
                    visibleCategories.add(category);
                    this.classList.add('active');
                }
                
                createMarkers();
            });
        });

        function updateCoordinatesDisplay() {
            const display = document.getElementById('coordinatesDisplay');
            display.innerHTML = '';
            
            Object.entries(coordinates).forEach(([name, coord]) => {
                const item = document.createElement('div');
                item.className = 'coordinate-item';
                item.innerHTML = `
                    <div class="coordinate-name">${name.replace(/_/g, ' ')}</div>
                    <div class="coordinate-values">${coord.x}, ${coord.y}</div>
                `;
                display.appendChild(item);
            });
        }

        function updateStats() {
            const categories = {
                basic: 0,
                organs: 0,
                reproductive: 0,
                muscular: 0
            };
            
            Object.values(coordinates).forEach(coord => {
                categories[coord.category]++;
            });
            
            document.getElementById('totalPoints').textContent = Object.values(coordinates).length;
            document.getElementById('basicPoints').textContent = categories.basic;
            document.getElementById('specializedPoints').textContent = Object.values(coordinates).length - categories.basic;
        }

        function exportJSON() {
            const statusDiv = document.getElementById('exportStatus');
            statusDiv.innerHTML = '<span style="color: #0891b2;">üîÑ Preparing export...</span>';
            
            const exportData = {
                image_name: "femaleleftside.png",
                image_type: "lateral_profile", 
                image_dimensions: {
                    width: 512,
                    height: 768
                },
                body_parts: {}
            };

            // Convert coordinates to export format
            Object.entries(coordinates).forEach(([name, coord]) => {
                exportData.body_parts[name] = {
                    x: coord.x,
                    y: coord.y,
                    width: coord.width,
                    height: coord.height
                };
                
                if (coord.category !== 'basic') {
                    exportData.body_parts[name].status = "estimated";
                }
            });

            exportData.export_timestamp = new Date().toISOString();
            exportData.modified_by = "coordinate_editor";
            exportData.total_points = Object.keys(coordinates).length;

            // Create and download file
            const jsonString = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const a = document.createElement('a');
            a.href = url;
            a.download = `femaleleftside_coordinates_${timestamp}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            statusDiv.innerHTML = '<span style="color: #059669;">‚úÖ JSON exported successfully! Check your downloads folder.</span>';
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }

        function resetCoordinates() {
            if (confirm('Are you sure you want to reset all coordinates to their original positions?')) {
                coordinates = JSON.parse(JSON.stringify(originalCoordinates));
                createMarkers();
                document.getElementById('exportStatus').innerHTML = '<span style="color: #059669;">üîÑ Coordinates reset to original positions</span>';
                setTimeout(() => {
                    document.getElementById('exportStatus').innerHTML = '';
                }, 3000);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCoordinatesDisplay();
            updateStats();
        });
    </script>
</body>
</html>
